<style>
    .mar-10 {
        margin-left: 20px;
        margin-right: 10px;
    }
</style>
<script>
//<![CDATA[
    XHR.poll(5, '<%=url("admin/nas/qbittorrent/status")%>', null, function(x, data) {
        var tb = document.getElementById('qbittorrent_status');
        if (data && tb) {
            if (data.running) {
                var links = '<em><b><font color="green">qBittorrent <%:RUNNING%></font></b></em><input type="button" class="cbi-button cbi-button-apply mar-10" value="<%:Open Web Interface%>"/>';
                if (data.pat) {
                    links += `<em><%:The current qBittorrent is at%><font color="red">${data.pat}</em>`;
                }
                tb.onclick = () => openwebui(data.port, data.pid, data.https);
                tb.innerHTML = links;
            } else {
                tb.innerHTML = '<em><b><font color="red">qBittorrent <%:NOT RUNNING%></font></b></em>';
            }
        }
    });

    function openwebui(port, pid, https) {
        var protocol = (https === false) ? 'https://' : 'http://';
        var url = `${protocol}${window.location.host}:${port}`;
        window.open(url, 'qbittorrent');
    };

    function randomToken() {
        var minPort = 1024;
        var maxPort = 65535;
        document.getElementById('cbid.qbittorrent.main.PortRangeMin').value = Math.floor(Math.random() * (maxPort - minPort + 1)) + minPort;
    };
//]]>
</script>
<fieldset class="cbi-section">
    <p id="qbittorrent_status">
        <em><%:Collecting data...%></em>
    </p>
</fieldset>

#!/bin/sh /etc/rc.common

START=99
enable=$(uci -q get ddnsto.ddnsto.enable 2>/dev/null)

start() {
	[ x$enable = x1 ] || return 0
	token=$(uci -q get ddnsto.ddnsto.token 2>/dev/null) || {
		logger -t ddnsto "token值为空"
		return 0
	}
	/usr/bin/ddnsto -u $token -d >/dev/null 2>&1 && \
	logger -t ddnsto "启动 ddnsto 服务"
}

stop() {
	pidof ddnsto >/dev/null && {
		killall ddnsto 2>/dev/null && \
		logger -t ddnsto "关闭 ddnsto 服务"
	}
}

boot() {
	delay_start=$(uci -q get ddnsto.ddnsto.start_delay)
	[[ x$enable = x1 && x$delay_start != x ]] && {
		logger -t ddnsto "延时$delay_start秒启动 ddnsto"
		sleep "$delay_start" && start
	} || return 0
}

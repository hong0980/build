<!-- https://www.jsdelivr.com/package/npm/codemirror -->
<%local con = luci.model.uci:get_all("luci", "tinynote")%>
<style>
	.CodeMirror {
		font-size: <%=con.font_size%>px;
		line-height: <%=con.line_spacing%>%;
		resize: both !important;
		text-align: left !important;
		font-family: Consolas, monospace !important;
	}
</style>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/codemirror@6.65.7/lib/codemirror.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/codemirror@6.65.7/addon/lint/lint.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/codemirror@6.65.7/addon/dialog/dialog.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/codemirror@6.65.7/addon/hint/show-hint.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/codemirror@6.65.7/addon/fold/foldgutter.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/codemirror@6.65.7/addon/display/fullscreen.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/codemirror@6.65.7/addon/search/matchesonscrollbar.css">
<!-- theme -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/codemirror@6.65.7/theme/<%=con.theme%>.css">

<script src="https://cdn.jsdelivr.net/npm/codemirror@6.65.7/lib/codemirror.js"></script>
<script src="https://cdn.jsdelivr.net/npm/codemirror@6.65.7/keymap/emacs.js"></script>
<script src="https://cdn.jsdelivr.net/npm/codemirror@6.65.7/keymap/sublime.js"></script>

<script src="https://cdn.jsdelivr.net/npm/codemirror@6.65.7/addon/dialog/dialog.js"></script>

<script src="https://cdn.jsdelivr.net/npm/codemirror@6.65.7/addon/fold/xml-fold.js"></script>
<script src="https://cdn.jsdelivr.net/npm/codemirror@6.65.7/addon/fold/foldcode.js"></script>
<script src="https://cdn.jsdelivr.net/npm/codemirror@6.65.7/addon/fold/foldgutter.js"></script>
<script src="https://cdn.jsdelivr.net/npm/codemirror@6.65.7/addon/fold/brace-fold.js"></script>
<script src="https://cdn.jsdelivr.net/npm/codemirror@6.65.7/addon/fold/markdown-fold.js"></script>

<script src="https://cdn.jsdelivr.net/npm/codemirror@6.65.7/addon/search/search.js"></script>
<script src="https://cdn.jsdelivr.net/npm/codemirror@6.65.7/addon/search/jump-to-line.js"></script>
<script src="https://cdn.jsdelivr.net/npm/codemirror@6.65.7/addon/search/searchcursor.js"></script>
<script src="https://cdn.jsdelivr.net/npm/codemirror@6.65.7/addon/search/jump-to-line.js"></script>
<script src="https://cdn.jsdelivr.net/npm/codemirror@6.65.7/addon/search/match-highlighter.js"></script>
<script src="https://cdn.jsdelivr.net/npm/codemirror@6.65.7/addon/search/matchesonscrollbar.js"></script>

<script src="https://cdn.jsdelivr.net/npm/codemirror@6.65.7/addon/selection/active-line.js"></script>
<script src="https://cdn.jsdelivr.net/npm/codemirror@6.65.7/addon/selection/mark-selection.js"></script>
<script src="https://cdn.jsdelivr.net/npm/codemirror@6.65.7/addon/scroll/annotatescrollbar.js"></script>

<script src="https://cdn.jsdelivr.net/npm/codemirror@6.65.7/addon/display/fullscreen.js"></script>
<script src="https://cdn.jsdelivr.net/npm/codemirror@6.65.7/addon/display/autorefresh.js"></script>

<script src="https://cdn.jsdelivr.net/npm/codemirror@6.65.7/addon/lint/lint.js"></script>
<script src="https://cdn.jsdelivr.net/npm/codemirror@6.65.7/addon/lint/yaml-lint.js"></script>
<script src="https://cdn.jsdelivr.net/npm/codemirror@6.65.7/addon/lint/javascript-lint.js"></script>

<script src="https://cdn.jsdelivr.net/npm/codemirror@6.65.7/addon/hint/xml-hint.js"></script>
<script src="https://cdn.jsdelivr.net/npm/codemirror@6.65.7/addon/hint/css-hint.js"></script>
<script src="https://cdn.jsdelivr.net/npm/codemirror@6.65.7/addon/hint/html-hint.js"></script>
<script src="https://cdn.jsdelivr.net/npm/codemirror@6.65.7/addon/hint/show-hint.js"></script>
<script src="https://cdn.jsdelivr.net/npm/codemirror@6.65.7/addon/hint/anyword-hint.js"></script>
<script src="https://cdn.jsdelivr.net/npm/codemirror@6.65.7/addon/hint/javascript-hint.js"></script>

<script src="https://cdn.jsdelivr.net/npm/codemirror@6.65.7/addon/edit/closetag.js"></script>
<script src="https://cdn.jsdelivr.net/npm/codemirror@6.65.7/addon/edit/matchtags.js"></script>
<script src="https://cdn.jsdelivr.net/npm/codemirror@6.65.7/addon/edit/matchbrackets.js"></script>
<script src="https://cdn.jsdelivr.net/npm/codemirror@6.65.7/addon/edit/closebrackets.js"></script>

<!-- mode -->
<script src="https://cdn.jsdelivr.net/npm/codemirror@6.65.7/mode/xml/xml.js"></script>
<script src="https://cdn.jsdelivr.net/npm/codemirror@6.65.7/mode/css/css.js"></script>
<script src="https://cdn.jsdelivr.net/npm/codemirror@6.65.7/mode/lua/lua.js"></script>
<script src="https://cdn.jsdelivr.net/npm/codemirror@6.65.7/mode/yaml/yaml.js"></script>
<script src="https://cdn.jsdelivr.net/npm/codemirror@6.65.7/mode/shell/shell.js"></script>
<script src="https://cdn.jsdelivr.net/npm/codemirror@6.65.7/mode/python/python.js"></script>
<script src="https://cdn.jsdelivr.net/npm/codemirror@6.65.7/mode/markdown/markdown.js"></script>
<script src="https://cdn.jsdelivr.net/npm/codemirror@6.65.7/mode/htmlmixed/htmlmixed.js"></script>
<script src="https://cdn.jsdelivr.net/npm/codemirror@6.65.7/mode/javascript/javascript.js"></script>
<script src="https://cdn.jsdelivr.net/npm/codemirror@6.65.7/mode/yaml-frontmatter/yaml-frontmatter.js"></script>

<!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/6.65.7/codemirror.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/6.65.7/codemirror.css"> -->

<script>//<![CDATA[
function editor(id, editor_mode) {
	var editor = CodeMirror.fromTextArea(id, {
		mode: editor_mode,
		autoRefresh: true,				// 自动更新
		lint: true,						// 检查格式
		tabSize: 4,						// tab的空格个数
		keyMap: 'sublime',				// sublime编辑器效果
		theme: "<%=con.theme%>",		// 主题
		foldGutter: true,				// 可将对象折叠，与下面的gutters一起使用
		indentUnit: 4,					// 每个缩进块由几个空格组成。默认为2。
		autocorrect: true,				// 自动更正
		spellcheck: true,				// 拼写检查
		autoCloseBrackets: true,		// 在键入时将自动关闭括号和引号
		matchTags: { bothTags: true },  // 将突出显示光标周围的标签
		smartIndent: true,				// 自动缩进
		styleActiveLine: true,			// 选中行高亮
		matchBrackets: true,			// 光标匹配括号
		lineNumbers: true,				// 是否显示行号
		lineWrapping: true,				// 是否应滚动或换行以显示长行
		lineWiseCopyCut: true,			// 在没有选择的情况下进行复制或剪切将复制或剪切有光标的整行。
		showCursorWhenSelecting: true,	// 选择处于活动状态时是否应绘制光标
		maxHighlightLength: 1000		// 默认为 10000（行），最多渲染行数.为 Infinity 时，渲染所有行。
		viewportMargin: 20,				// 渲染可视范围前后的多少行。建议使用默认值 10。
		extraKeys: {
			"F11": function(cm) {
				cm.setOption("fullScreen", !cm.getOption("fullScreen"));
			},
			"Esc": function(cm) {
				if (cm.getOption("fullScreen")) cm.setOption("fullScreen", false);
			},
			"Tab": function(cm) {
				if (cm.somethingSelected()) {
					cm.indentSelection('add')
				} else {
					var spaces = Array(cm.getOption("indentUnit") + 1).join(" ")
					cm.replaceSelection(spaces)
				}
			},
		},
	});
	editor.setSize("<%=con.width%>", "<%=con.height%>");

	if ("<%=con.only%>" == "1") {
		editor.setOption("readOnly", "true");
	};
};

// function myFunction(ids) {
//     var idList = ids.split(" ");
//     var elements = new Array();
//     for (var i = 0; i < idList.length; i++){
//         var element = idList[i];
//         if (typeof element == 'string')
//             element = document.getElementById(element);
//         if (idList.length == 1)
//             return element;
//         elements.push(element);
//     }
//     return(elements);
// }

// myFunction("note1 note2 note3 note4 note5 note6 note7 note8 note9");

var note1 = document.getElementById("cbid.luci.tinynote.note1.lua");
var note2 = document.getElementById("cbid.luci.tinynote.note2.lua");
var note3 = document.getElementById("cbid.luci.tinynote.note3.lua");
var note4 = document.getElementById("cbid.luci.tinynote.note4.lua");
var note5 = document.getElementById("cbid.luci.tinynote.note5.lua");
var note6 = document.getElementById("cbid.luci.tinynote.note6.lua");
var note7 = document.getElementById("cbid.luci.tinynote.note7.lua");
var note8 = document.getElementById("cbid.luci.tinynote.note8.lua");

if (note1) {
	editor(note1, 'lua');
};

if (note2) {
	editor(note2, 'lua');
};

if (note3) {
	editor(note3, 'lua');
};

if (note4) {
	editor(note4, 'lua');
};

if (note5) {
	editor(note5, 'python');
};

if (note6) {
	editor(note6, 'lua');
};

if (note7) {
	editor(note7, 'shell');
};

if (note8) {
	editor(note8, 'lua');
};

//]]>
</script>
